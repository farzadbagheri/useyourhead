<html>
	<head>
		<link rel="stylesheet" type="text/css" href="styles.css">
	</head>
	<body>
		<img id="basket" width="100" height="100" src="basket.png" alt="basket">
		<img id="basketball" width="100" height="100" src="basketball.png" alt="basketball">
		<video style="display: none;"id="inputVideo" width="1280" height="720" autoplay loop>
		</video>
		<canvas id ="myCanvas"
                width='1280' height='720' style = " background-color: rgb(250,152,108);"> </canvas>
		<script src="clmtrackr.js"></script>
		<script type="text/javascript">
			var score = 0;
			var vy = 4;
			var gravity = 0.001;
			var video = document.getElementById('video');
			var constraints = { video: { width: 1280, height: 720 } }; 
			function getRandomInt(max) { //from MDN
  				return Math.floor(Math.random() * Math.floor(max));
			}
			var basket = document.getElementById("basket");
			var basketball = document.getElementById("basketball");

   			
			navigator.mediaDevices.getUserMedia(constraints)
			.then(function(mediaStream) {
			  var video = document.querySelector('video');
			  video.srcObject = mediaStream;
			  video.onloadedmetadata = function(e) {
			    video.play();
			  };
			  var ctracker = new clm.tracker();
			  ctracker.init();
			  ctracker.start(video);
				var canvas = document.getElementById("myCanvas")
       			var context = canvas.getContext("2d")  
       			function Ball(position, offset) {
       				if(position > 0.75)  {
       					position = 0.75;
       				} else if(position < 0.25) {
       					position = 0.25;
       				}
				    this.x = (canvas.width * position) ;
				    this.y = 0 - getRandomInt(offset);;
				 	this.degrees = 0;
				    this.draw = function(context) {
						context.drawImage(basketball, this.x - basketball.width, this.y - basketball.height);
				    }
				}

				function getNewBalls() {
					let balls = [];
	 				for(var k = 0; k < 1 + getRandomInt(4); k++) {
						balls[k] = new Ball(Math.random(), getRandomInt(1000));

	 				}
	 				return balls
				}
        		let balls = getNewBalls();
     
			  function positionLoop() {
			    requestAnimationFrame(positionLoop);
			    var positions = ctracker.getCurrentPosition();
			    context.clearRect(0, 0, canvas.width, canvas.height)
			    context.beginPath()
		          
		   
		    	if(positions[62])  {
		    		
		    		context.drawImage(basket, canvas.width - positions[62][0] - basket.width, positions[62][1] - basket.height);
		    	}
        		
			   //console.log('here before loop', balls, balls.length	)
            	for (var j = balls.length - 1; j >= 0; j--) {
            		balls[j].y += vy += gravity;
            		
            		// console.log(balls[j].y)

            		balls[j].draw(context);

            		if(positions[62] && (balls[j].y >= positions[62][1] && 
            			balls[j].y <= positions[62][1] + basket.height &&
            			balls[j].x <= canvas.width - positions[62][0] + basket.width &&
            			balls[j].x >= canvas.width - positions[62][0] - basket.width / 2) 
      					){
            			balls[j] = new Ball(Math.random(), getRandomInt(1500));

            			score++
            		} else if (balls[j].y > canvas.height) {
            			balls[j] = new Ball(Math.random(), getRandomInt(1500));
            		}
            	}
			    context.font = "50px  Courier New"
        		context.fillText("Use Your Head!", 25,75)
        		context.strokeText('score: ' + score, 1000,75)
			  }
			  positionLoop();
			  
			})
			.catch(function(err) { console.log(err.name + ": " + err.message); });
		</script>
		
	</body>
</html>